# Architecture Diagrams

This directory contains architecture visualizations for the srv-m1m data plane.

## Overall Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                         srv-m1m (Apple M1)                         │
│                     Fedora Asahi Linux (ARM64)                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                    Tailscale Interface                       │   │
│  │                      100.104.206.96                         │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                              │                                      │
│         ┌────────────────────┼────────────────────┐                │
│         │                    │                    │                │
│         ▼                    ▼                    ▼                │
│  ┌─────────────┐      ┌─────────────┐      ┌─────────────┐         │
│  │   Services  │      │   Services  │      │   Services  │         │
│  │  (systemd)  │      │   (Podman)  │      │  (Podman)   │         │
│  └─────────────┘      └─────────────┘      └─────────────┘         │
│        │                    │                    │                  │
│        ▼                    ▼                    ▼                  │
│  ┌─────────────┐      ┌─────────────┐      ┌─────────────┐         │
│  │ Forgejo     │      │ DMR         │      │ nginx       │         │
│  │ PostgreSQL  │      │ MCP Server  │      │ Vaultwarden │         │
│  │ Prometheus  │      │             │      │             │         │
│  │ Grafana     │      │             │      │             │         │
│  │ node_exp    │      │             │      │             │         │
│  └─────────────┘      └─────────────┘      └─────────────┘         │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

## Service Topology

```
                              ┌─────────────────┐
                              │   External      │
                              │    Clients      │
                              │ (Tailscale)    │
                              └────────┬────────┘
                                       │
                                       ▼
┌───────────────────────────────────────────────────────────────────┐
│                         nginx Reverse Proxy                        │
│                           (Port 80/443)                           │
└───────────────────────────────┬───────────────────────────────────┘
                                │
        ┌───────────┬───────────┼───────────┬───────────┐
        │           │           │           │           │
        ▼           ▼           ▼           ▼           ▼
   ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐
   │Forgejo │ │Grafana │ │ Vault- │ │  DMR   │ │  RAG   │
   │  :3000 │ │ :3001  │ │ warden │ │ :12434 │ │ :11434 │
   │        │ │        │ │ :8222  │ │        │ │        │
   └────────┘ └────────┘ └────────┘ └────────┘ └────────┘
        │           │           │           │
        └───────────┴───────────┼───────────┘
                                │
                                ▼
                    ┌─────────────────────┐
                    │   PostgreSQL       │
                    │      :5432         │
                    │   (pgvector)       │
                    └─────────────────────┘
```

## Monitoring Stack

```
┌─────────────────────────────────────────────────────────────────────┐
│                        Monitoring Architecture                        │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   ┌──────────────┐         ┌──────────────┐                       │
│   │   T480       │         │   srv-m1m    │                       │
│   │   (remote    │◄────────│              │                       │
│   │   write)     │         │ node_exp     │                       │
│   └──────────────┘         └──────┬───────┘                       │
│                                   │                                │
│                                   ▼                                │
│                          ┌──────────────┐                         │
│                          │  Prometheus   │                         │
│                          │    :9090      │                         │
│                          └──────┬───────┘                         │
│                                 │                                  │
│                                 ▼                                  │
│                          ┌──────────────┐                         │
│                          │   Grafana    │                         │
│                          │    :3001     │                         │
│                          └──────────────┘                         │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

## AI Platform

```
┌─────────────────────────────────────────────────────────────────────┐
│                        AI Platform Architecture                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   T480                                                           │
│   OpenCode                                                        │
│      │                                                            │
│      │ SSH Tunnel                                                 │
│      ▼                                                            │
│   ┌──────────────┐                                                │
│   │ MCP Server   │  ← Project Context (Markdown)                  │
│   │   :8082      │                                                │
│   └──────┬───────┘                                                │
│          │                                                        │
│          ▼                                                        │
│   ┌──────────────┐                                                │
│   │     DMR      │  ← Qwen3 Models (8B/4B/0.6B)                  │
│   │   :12434     │                                                │
│   └──────────────┘                                                │
│                                                                     │
│   Future:                                                         │
│   ┌──────────────┐    ┌──────────────┐                          │
│   │  RAG API     │◄──►│  PostgreSQL   │                          │
│   │   :11434     │    │  (pgvector)   │                          │
│   └──────────────┘    └──────────────┘                          │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```
